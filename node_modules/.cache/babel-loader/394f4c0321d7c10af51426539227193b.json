{"ast":null,"code":"var _jsxFileName = \"/Volumes/Macintosh HD - \\u6570\\u636E/yu01/d3_ex/src/chart/partitionchart/partitionCircleChart.jsx\";\nimport React, { Component } from \"react\";\nimport * as d3 from 'd3';\n\nclass PartitionCircleChart extends Component {\n  constructor(props) {\n    super(props);\n    this.data = props.chartState;\n  }\n\n  drawPartition(data) {\n    const padding = this.data.padding;\n    const width = this.data.width;\n    const pieHeight = this.data.pieHeight;\n    const radius = this.data.radius; // 初始化树状图数据获取器\n\n    const partition = d3.partition().size([2 * Math.PI, radius * radius]); // 初始化json数据转成一棵树，这个步骤是非常必要的！！\n    // 将给定的有层次结构的数据转成符合绘图要求的数组\n\n    const root = d3.hierarchy(data); // 分区图中不能sum\n    // .sum(function (d) { return d.value })  // 每个节点的value都是自身和所有后代节点的value之和\n    // 初始化分区图\n\n    let partitionData = partition(root);\n    console.log(partitionData); // 获取分区\n\n    let block = partitionData.descendants();\n    const color = d3.scaleOrdinal(d3.schemeCategory10);\n    const svg = d3.select(\"body\").append(\"svg\").attr(\"width\", this.data.width).attr(\"height\", this.data.pieHeight).style('padding-left', padding.left).style('padding-top', padding.top); // 创建弧生成器\n\n    const arc = d3.arc().innerRadius(function (d) {\n      return Math.sqrt(d.y0);\n    }).outerRadius(function (d) {\n      return Math.sqrt(d.y1);\n    }).startAngle(function (d) {\n      return d.x0;\n    }).endAngle(function (d) {\n      return d.x1;\n    });\n    let g = svg.selectAll('g').data(block).enter().append('g').attr('transform', 'translate(' + 200 + ',' + 200 + ')'); // 画弧线\n\n    g.append('path').attr('display', function (d) {\n      return d.depth ? 'none' : 'none';\n    }) // 是否绘制中心,留白好看一些\n    .attr('d', arc).style('stroke', '#ccc').style('fill', function (d) {\n      return color(d.data.name);\n    }); // 添加文字\n\n    g.append('text').attr('transform', function (d, i) {\n      if (i !== 0) {\n        let r = (d.x0 + d.x1) / 2;\n        let angle = Math.PI / 2;\n        r += r < Math.PI ? angle - Math.PI : angle;\n        r *= 180 / Math.PI;\n        return 'translate(' + arc.centroid(d) + ')' + 'rotate(' + r + ')';\n      }\n    }).text(function (d) {\n      return d.data.name;\n    }).attr('font-size', function (d) {\n      return 12 - d.depth + 'px';\n    }) // 文字按深度缩小\n    .attr('dy', '.5em').attr('dx', function (d) {\n      return -d.data.name.length / 2 + 'em';\n    }); // 文字居中\n  }\n\n  componentDidMount() {\n    this.drawPartition(this.data.packData);\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 12\n      }\n    });\n  }\n\n}\n\nexport default PartitionCircleChart;","map":{"version":3,"sources":["/Volumes/Macintosh HD - 数据/yu01/d3_ex/src/chart/partitionchart/partitionCircleChart.jsx"],"names":["React","Component","d3","PartitionCircleChart","constructor","props","data","chartState","drawPartition","padding","width","pieHeight","radius","partition","size","Math","PI","root","hierarchy","partitionData","console","log","block","descendants","color","scaleOrdinal","schemeCategory10","svg","select","append","attr","style","left","top","arc","innerRadius","d","sqrt","y0","outerRadius","y1","startAngle","x0","endAngle","x1","g","selectAll","enter","depth","name","i","r","angle","centroid","text","length","componentDidMount","packData","render"],"mappings":"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","sourcesContent":["import React,{Component} from \"react\";\nimport * as d3 from 'd3'\n\nclass PartitionCircleChart extends Component{\n  constructor(props) {\n    super(props);\n    this.data = props.chartState\n  }\n\n  drawPartition (data) {\n    const padding = this.data.padding\n    const width = this.data.width\n    const pieHeight = this.data.pieHeight\n    const radius = this.data.radius\n\n    // 初始化树状图数据获取器\n    const partition = d3.partition()\n                        .size([2 * Math.PI, radius * radius])\n\n    // 初始化json数据转成一棵树，这个步骤是非常必要的！！\n    // 将给定的有层次结构的数据转成符合绘图要求的数组\n    const root = d3.hierarchy(data)\n      // 分区图中不能sum\n      // .sum(function (d) { return d.value })  // 每个节点的value都是自身和所有后代节点的value之和\n\n    // 初始化分区图\n    let partitionData = partition(root)\n    console.log(partitionData)\n    // 获取分区\n    let block = partitionData.descendants()\n\n    const color = d3.scaleOrdinal(d3.schemeCategory10)\n\n    const svg = d3.select(\"body\")\n      .append(\"svg\")\n      .attr(\"width\", this.data.width)\n      .attr(\"height\", this.data.pieHeight)\n      .style('padding-left', padding.left)\n      .style('padding-top', padding.top)\n\n    // 创建弧生成器\n    const arc = d3.arc()\n                  .innerRadius(function (d) { return Math.sqrt(d.y0) })\n                  .outerRadius(function (d) { return Math.sqrt(d.y1) })\n                  .startAngle(function (d) { return d.x0 })\n                  .endAngle(function (d) { return d.x1 })\n\n    let g = svg.selectAll('g')\n      .data(block)\n      .enter()\n      .append('g')\n      .attr('transform', 'translate(' + 200 + ',' + 200 + ')')\n\n    // 画弧线\n    g.append('path')\n      .attr('display', function (d) {\n        return d.depth ? 'none' : 'none'\n      })// 是否绘制中心,留白好看一些\n      .attr('d', arc)\n      .style('stroke', '#ccc')\n      .style('fill', function (d) { return color(d.data.name) })\n\n    // 添加文字\n    g.append('text')\n      .attr('transform', function (d, i) {\n        if (i !== 0) {\n          let r = (d.x0 + d.x1) / 2\n          let angle = Math.PI / 2\n          r += r < Math.PI ? (angle - Math.PI) : angle\n          r *= 180 / Math.PI\n          return 'translate(' + arc.centroid(d) + ')' + 'rotate(' + r + ')'\n        }\n      })\n      .text(function (d) { return d.data.name })\n      .attr('font-size', function (d) { return 12 - d.depth + 'px' }) // 文字按深度缩小\n      .attr('dy', '.5em')\n      .attr('dx', function (d) { return -d.data.name.length / 2 + 'em' }) // 文字居中\n  }\n\n  componentDidMount() {\n    this.drawPartition(this.data.packData)\n  }\n\n  render() {\n    return <div></div>\n  }\n\n}\n\nexport default PartitionCircleChart"]},"metadata":{},"sourceType":"module"}