{"ast":null,"code":"var _jsxFileName = \"/Volumes/Macintosh HD - \\u6570\\u636E/yu01/d3_ex/src/chart/stackChart/stackChart.jsx\";\nimport React, { Component } from \"react\";\nimport * as d3 from 'd3';\n\nclass StackChart extends Component {\n  constructor(props) {\n    super(props);\n    this.data = props.chartState;\n  }\n\n  drawStack(data) {\n    const padding = this.data.padding;\n    const width = this.data.width;\n    const pieHeight = this.data.pieHeight;\n    const stack = d3.stack().keys([\"apples\", \"bananas\", \"cherries\", \"dates\"]).order(d3.stackOrderNone).offset(d3.stackOffsetNone);\n    const stackData = stack(data);\n    console.log(stackData);\n    const color = d3.scaleOrdinal(d3.schemeCategory10);\n    const svg = d3.select(\"body\").append(\"svg\").attr(\"width\", width).attr(\"height\", pieHeight).style('padding-left', padding.left).style('padding-top', padding.top); // x比例尺\n\n    let xScale = d3.scaleBand().range([0, width - padding.left - padding.right]); // x值域，其实就是月份\n\n    xScale.domain(data.map(d => d.month));\n    let yScale = d3.scaleLinear().range([pieHeight - padding.top - padding.bottom, 0]); // y值域，求的是转化后的数组的最后一个数组中的第二个元素的最大值，绕的我都有点晕，最大值怎么求可以自己写function\n\n    yScale.domain([0, d3.max(stackData[stackData.length - 1], item => item[1])]); // x轴和y轴\n\n    let xAxis = d3.axisBottom().scale(xScale);\n    let yAxis = d3.axisLeft(yScale); // 添加x轴\n\n    svg.append('g').attr('class', 'axis').attr('transform', 'translate(' + padding.left + ',' + (height - padding.bottom) + ')').call(xAxis); // 添加y轴\n\n    svg.append('g').attr('class', 'axis').attr('transform', 'translate(' + padding.left + ',' + padding.top + ')').call(yAxis); // 将二维数组的第一维剥离，打散成n列\n\n    let rectContainer = svg.selectAll('rectContainer').data(stackData).enter().append('g').attr('class', 'rectContainer').attr('fill', (d, i) => {\n      return color(i);\n    }); // 渲染每一列\n\n    rectContainer.selectAll('rect').data(d => d).enter().append('rect').attr('x', d => {\n      return xScale(d.data.month) + padding.left + margin / 2;\n    }).attr('y', d => {\n      return yScale(d[1]) + padding.top;\n    }).attr('width', d => {\n      return xScale.bandwidth() - margin;\n    }).attr('height', d => {\n      return height - padding.top - padding.bottom - yScale(d[1] - d[0]);\n    }).attr('stroke', '#ccc'); // 添加描述\n\n    svg.selectAll('circle').data(['apples', 'bananas', 'cherries', 'oranges']).enter().append('circle').attr('cx', d => {\n      return width - padding.right - 80;\n    }).attr('cy', (d, i) => {\n      return padding.top + 25 * i;\n    }).attr('r', '6').attr('fill', d => {\n      return colorZ(d);\n    });\n    let texts = svg.selectAll('textContainer').data(['apples', 'bananas', 'cherries', 'oranges']).enter().append('g').attr('class', 'textContainer');\n    texts.append('text').attr('x', d => {\n      return width - padding.right - 60;\n    }).attr('y', (d, i) => {\n      return padding.top + 25 * i;\n    }).attr('dy', '0.32em').text(d => d).attr('fill', d => colorZ(d));\n  }\n\n  componentDidMount() {\n    this.drawStack(this.data.stackData);\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 12\n      }\n    });\n  }\n\n}\n\nexport default StackChart;","map":{"version":3,"sources":["/Volumes/Macintosh HD - 数据/yu01/d3_ex/src/chart/stackChart/stackChart.jsx"],"names":["React","Component","d3","StackChart","constructor","props","data","chartState","drawStack","padding","width","pieHeight","stack","keys","order","stackOrderNone","offset","stackOffsetNone","stackData","console","log","color","scaleOrdinal","schemeCategory10","svg","select","append","attr","style","left","top","xScale","scaleBand","range","right","domain","map","d","month","yScale","scaleLinear","bottom","max","length","item","xAxis","axisBottom","scale","yAxis","axisLeft","height","call","rectContainer","selectAll","enter","i","margin","bandwidth","colorZ","texts","text","componentDidMount","render"],"mappings":"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","sourcesContent":["import React,{Component} from \"react\";\nimport * as d3 from 'd3'\n\nclass StackChart extends Component{\n  constructor(props) {\n    super(props);\n    this.data = props.chartState\n  }\n\n  drawStack (data) {\n    const padding = this.data.padding\n    const width = this.data.width\n    const pieHeight = this.data.pieHeight\n\n    const stack = d3.stack()\n      .keys([\"apples\", \"bananas\", \"cherries\", \"dates\"])\n      .order(d3.stackOrderNone)\n      .offset(d3.stackOffsetNone);\n\n    const stackData = stack(data)\n    console.log(stackData)\n\n    const color = d3.scaleOrdinal(d3.schemeCategory10)\n\n    const svg = d3.select(\"body\")\n      .append(\"svg\")\n      .attr(\"width\", width)\n      .attr(\"height\", pieHeight)\n      .style('padding-left', padding.left)\n      .style('padding-top', padding.top)\n\n    // x比例尺\n    let xScale = d3.scaleBand()\n      .range([0, width - padding.left - padding.right])\n    // x值域，其实就是月份\n    xScale.domain(data.map((d) => d.month))\n    let yScale = d3.scaleLinear()\n      .range([pieHeight - padding.top - padding.bottom, 0])\n    // y值域，求的是转化后的数组的最后一个数组中的第二个元素的最大值，绕的我都有点晕，最大值怎么求可以自己写function\n    yScale.domain([0, d3.max(stackData[stackData.length - 1], (item) => item[1])])\n\n    // x轴和y轴\n    let xAxis = d3.axisBottom().scale(xScale)\n    let yAxis = d3.axisLeft(yScale)\n\n    // 添加x轴\n    svg.append('g')\n      .attr('class', 'axis')\n      .attr('transform', 'translate(' + padding.left + ',' + (height - padding.bottom) + ')')\n      .call(xAxis)\n    // 添加y轴\n    svg.append('g')\n      .attr('class', 'axis')\n      .attr('transform', 'translate(' + padding.left + ',' + padding.top + ')')\n      .call(yAxis)\n\n    // 将二维数组的第一维剥离，打散成n列\n    let rectContainer = svg.selectAll('rectContainer')\n      .data(stackData)\n      .enter()\n      .append('g')\n      .attr('class', 'rectContainer')\n      .attr('fill', (d, i) => { return color(i) })\n\n    // 渲染每一列\n    rectContainer.selectAll('rect')\n      .data((d) => d)\n      .enter()\n      .append('rect')\n      .attr('x', (d) => { return xScale(d.data.month) + padding.left + margin / 2 })\n      .attr('y', (d) => { return yScale(d[1]) + padding.top })\n      .attr('width', (d) => { return xScale.bandwidth() - margin })\n      .attr('height', (d) => { return height - padding.top - padding.bottom - yScale(d[1] - d[0]) })\n      .attr('stroke', '#ccc')\n\n    // 添加描述\n    svg.selectAll('circle')\n      .data(['apples', 'bananas', 'cherries', 'oranges'])\n      .enter()\n      .append('circle')\n      .attr('cx', (d) => { return width - padding.right - 80 })\n      .attr('cy', (d, i) => { return padding.top + 25 * i })\n      .attr('r', '6')\n      .attr('fill', (d) => { return colorZ(d) })\n    let texts = svg.selectAll('textContainer')\n      .data(['apples', 'bananas', 'cherries', 'oranges'])\n      .enter()\n      .append('g')\n      .attr('class', 'textContainer')\n    texts.append('text')\n      .attr('x', (d) => { return width - padding.right - 60 })\n      .attr('y', (d, i) => { return padding.top + 25 * i })\n      .attr('dy', '0.32em')\n      .text((d) => d)\n      .attr('fill', (d) => colorZ(d))\n\n  }\n\n  componentDidMount() {\n    this.drawStack(this.data.stackData)\n  }\n\n  render() {\n    return <div></div>\n  }\n\n}\n\nexport default StackChart"]},"metadata":{},"sourceType":"module"}