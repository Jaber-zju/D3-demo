{"ast":null,"code":"var _jsxFileName = \"/Volumes/Macintosh HD - \\u6570\\u636E/yu01/d3_ex/src/pack_chart.js\";\nimport React, { Component } from \"react\";\nimport * as d3 from 'd3';\n\nclass Pack_chart extends Component {\n  constructor(props) {\n    super(props);\n    this.data = props.chartState;\n  }\n\n  drawPack(data) {\n    const padding = this.data.padding;\n    const width = this.data.width;\n    const pieHeight = this.data.pieHeight;\n    const svg = d3.select(\"body\").append(\"svg\").attr(\"width\", this.data.width).attr(\"height\", this.data.pieHeight).style('padding-left', padding.left).style('padding-top', padding.top);\n    const color = d3.scaleSequential(d3.interpolateMagma).domain([-4, 4]); // const color = d3.schemeSet2\n\n    const pack = d3.pack().size([width - 4, pieHeight - 4]).padding(4);\n    const root = d3.hierarchy(data).sum(function (d) {\n      return d.value;\n    }).sort(function (a, b) {\n      return b.value - a.value;\n    }); // 降序\n\n    console.log(root);\n    let nodes = pack(root).descendants();\n    console.log(nodes); // 画圆\n\n    svg.selectAll('circle').data(nodes).enter().append('circle').style('fill', function (d) {\n      return color(d.depth);\n    }) // .style('fill', function (d) { return color[d.depth] })\n    .attr('cx', function (d) {\n      return d.x;\n    }).attr('cy', function (d) {\n      return d.y;\n    }).attr('r', function (d) {\n      return d.r;\n    }).on('mouseover', function (d) {\n      d3.event.target.style.stroke = 'yellow';\n      d3.event.target.style.strokeWidth = '2px';\n      svg.append('text').style('fill', 'black').style('opacity', '0.5').attr('class', 'hello').attr('x', d3.event.offsetX + 20).attr('y', d3.event.offsetY - 10).text(d.data.name);\n    }).on('mouseout', function (d) {\n      svg.selectAll('.hello').remove();\n      d3.event.target.style.strokeWidth = '0px';\n    }); // 文字\n\n    svg.selectAll('text').data(nodes).enter().append('text').style('fill', 'black').style('fill-opacity', function (d) {\n      return d.children ? 0 : 1;\n    }) // 设置包含子节点的文字不显示\n    .attr('x', function (d) {\n      return d.x;\n    }).attr('y', function (d) {\n      return d.y;\n    }).attr('dy', '.3em').attr('dx', function (d) {\n      return '-' + d.data.name.length / 2 + 'em';\n    }) // 设置文字居中，通过dx 负文字个数的二分之一\n    .text(function (d) {\n      return d.data.name;\n    }).style('font-size', function (d) {\n      return 12 - d.depth + 'px';\n    });\n  }\n\n  componentDidMount() {\n    this.drawPack(this.data.packData);\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 12\n      }\n    });\n  }\n\n}\n\nexport default Pack_chart;","map":{"version":3,"sources":["/Volumes/Macintosh HD - 数据/yu01/d3_ex/src/pack_chart.js"],"names":["React","Component","d3","Pack_chart","constructor","props","data","chartState","drawPack","padding","width","pieHeight","svg","select","append","attr","style","left","top","color","scaleSequential","interpolateMagma","domain","pack","size","root","hierarchy","sum","d","value","sort","a","b","console","log","nodes","descendants","selectAll","enter","depth","x","y","r","on","event","target","stroke","strokeWidth","offsetX","offsetY","text","name","remove","children","length","componentDidMount","packData","render"],"mappings":"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","sourcesContent":["import React,{Component} from \"react\";\nimport * as d3 from 'd3'\n\nclass Pack_chart extends Component{\n  constructor(props) {\n    super(props);\n    this.data = props.chartState\n  }\n\n  drawPack (data) {\n    const padding = this.data.padding\n    const width = this.data.width\n    const pieHeight = this.data.pieHeight\n\n    const svg = d3.select(\"body\")\n      .append(\"svg\")\n      .attr(\"width\", this.data.width)\n      .attr(\"height\", this.data.pieHeight)\n      .style('padding-left', padding.left)\n      .style('padding-top', padding.top)\n\n    const color = d3.scaleSequential(d3.interpolateMagma)\n      .domain([-4, 4])\n    // const color = d3.schemeSet2\n    const pack = d3.pack()\n      .size([width - 4, pieHeight - 4])\n      .padding(4)\n\n    const root = d3.hierarchy(data)\n      .sum(function (d) { return d.value })\n      .sort(function (a, b) { return b.value - a.value }) // 降序\n    console.log(root)\n    let nodes = pack(root).descendants()\n    console.log(nodes)\n\n    // 画圆\n    svg.selectAll('circle')\n      .data(nodes)\n      .enter()\n      .append('circle')\n      .style('fill', function (d) { return color(d.depth) })\n      // .style('fill', function (d) { return color[d.depth] })\n      .attr('cx', function (d) { return d.x })\n      .attr('cy', function (d) { return d.y })\n      .attr('r', function (d) { return d.r })\n      .on('mouseover', function (d) {\n        d3.event.target.style.stroke = 'yellow'\n        d3.event.target.style.strokeWidth = '2px'\n        svg.append('text')\n          .style('fill', 'black')\n          .style('opacity', '0.5')\n          .attr('class', 'hello')\n          .attr('x', d3.event.offsetX + 20)\n          .attr('y', d3.event.offsetY - 10)\n          .text(d.data.name)\n      })\n      .on('mouseout', function (d) {\n        svg.selectAll('.hello').remove()\n        d3.event.target.style.strokeWidth = '0px'\n      })\n\n    // 文字\n    svg.selectAll('text')\n      .data(nodes)\n      .enter()\n      .append('text')\n      .style('fill', 'black')\n      .style('fill-opacity', function (d) { return d.children ? 0 : 1 }) // 设置包含子节点的文字不显示\n      .attr('x', function (d) { return d.x })\n      .attr('y', function (d) { return d.y })\n      .attr('dy', '.3em')\n      .attr('dx', function (d) { return '-' + d.data.name.length / 2 + 'em' }) // 设置文字居中，通过dx 负文字个数的二分之一\n      .text(function (d) { return d.data.name })\n      .style('font-size', function (d) { return 12 - d.depth + 'px' })\n\n\n  }\n\n  componentDidMount() {\n    this.drawPack(this.data.packData)\n  }\n\n  render() {\n    return <div></div>\n  }\n\n}\n\nexport default Pack_chart"]},"metadata":{},"sourceType":"module"}