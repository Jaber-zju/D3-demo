{"ast":null,"code":"var _jsxFileName = \"/Volumes/Macintosh HD - \\u6570\\u636E/yu01/d3_ex/src/chart/treeMapChart/treeMapChart.jsx\";\nimport React, { Component } from \"react\";\nimport * as d3 from 'd3';\n\nclass TreeMapChart extends Component {\n  constructor(props) {\n    super(props);\n    this.data = props.chartState;\n  }\n\n  drawTreeMap(data) {\n    const padding = this.data.padding;\n    const width = this.data.width;\n    const pieHeight = this.data.pieHeight;\n    const radius = this.data.radius;\n    const svg = d3.select(\"body\").append(\"svg\").attr(\"width\", width).attr(\"height\", pieHeight).style('padding-left', padding.left).style('padding-top', padding.top);\n    const treeMap = d3.treemap().size([width, pieHeight]);\n    const root = d3.hierarchy(data).sum(function (d) {\n      return d.gdp;\n    }); // 每个节点的value都是自身和所有后代节点的value之和\n\n    const tree = treeMap(root); // 获取treemap结构树\n\n    const leaves = tree.leaves(); // 将生成的树形结构转化成叶子节点数组\n\n    const color = d3.scaleOrdinal(d3.schemeCategory10);\n    const g = svg.selectAll('g').data(leaves).enter().append('g');\n    g.append('rect').attr('x', d => d.x0).attr('y', d => d.y0).attr('width', d => d.x1 - d.x0).attr('height', d => d.y1 - d.y0).style('fill', d => color(d.parent.data.name)).style('stroke', '#cccccc');\n    g.append('text').attr('x', function (d) {\n      return d.x0;\n    }).attr('y', function (d) {\n      return d.y0;\n    }) // .attr('dx', (d) => { return -d.data.name.length / 2 + 'em' })\n    // .attr('dy', (d) => { return '-0.5em' })\n    .attr('dx', function (d) {\n      return (d.x1 - d.x0) / 2;\n    }) // 文字水平居中\n    .attr('dy', function (d) {\n      return (d.y1 - d.y0) / 2 - d.data.name.length / 2 * 12;\n    }) // 文字垂直居中,有点瑕疵\n    .attr('font-size', function (d) {\n      return 12 - d.depth + 'px';\n    }) // 文字按深度缩小\n    // .attr('writing-mode', 'tb') // 文字从上往下书写\n    .text(function (d) {\n      return d.data.name;\n    }).attr('fill', '#f0f0f0');\n    g.append('text').attr('x', d => (d.x1 - d.x0) / 2 + d.x0).attr('y', d => (d.y1 - d.y0) / 2 + d.y0).attr('dx', d => {\n      return -(d.value.toString().length + 2) / 4 + 'em';\n    }).attr('dy', d => {\n      return '1em';\n    }).text(d => {\n      return '(' + d.value + ')';\n    }).attr('font-size', d => {\n      return 14 - d.depth + 'px';\n    }).attr('fill', '#ffffff');\n  }\n\n  componentDidMount() {\n    this.drawTreeMap(this.data.treeMapData);\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 12\n      }\n    });\n  }\n\n}\n\nexport default TreeMapChart;","map":{"version":3,"sources":["/Volumes/Macintosh HD - 数据/yu01/d3_ex/src/chart/treeMapChart/treeMapChart.jsx"],"names":["React","Component","d3","TreeMapChart","constructor","props","data","chartState","drawTreeMap","padding","width","pieHeight","radius","svg","select","append","attr","style","left","top","treeMap","treemap","size","root","hierarchy","sum","d","gdp","tree","leaves","color","scaleOrdinal","schemeCategory10","g","selectAll","enter","x0","y0","x1","y1","parent","name","length","depth","text","value","toString","componentDidMount","treeMapData","render"],"mappings":"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","sourcesContent":["import React,{Component} from \"react\";\nimport * as d3 from 'd3'\n\nclass TreeMapChart extends Component{\n  constructor(props) {\n    super(props);\n    this.data = props.chartState\n  }\n\n  drawTreeMap (data) {\n    const padding = this.data.padding\n    const width = this.data.width\n    const pieHeight = this.data.pieHeight\n    const radius = this.data.radius\n\n    const svg = d3.select(\"body\")\n      .append(\"svg\")\n      .attr(\"width\", width)\n      .attr(\"height\", pieHeight)\n      .style('padding-left', padding.left)\n      .style('padding-top', padding.top)\n\n    const treeMap = d3.treemap().size([width, pieHeight])\n    const root = d3.hierarchy(data)\n                    .sum(function (d) { return d.gdp })  // 每个节点的value都是自身和所有后代节点的value之和\n\n    const tree = treeMap(root) // 获取treemap结构树\n    const leaves = tree.leaves() // 将生成的树形结构转化成叶子节点数组\n\n    const color = d3.scaleOrdinal(d3.schemeCategory10)\n\n    const g = svg.selectAll('g')\n                  .data(leaves)\n                  .enter()\n                  .append('g')\n\n    g.append('rect')\n      .attr('x', d => d.x0)\n      .attr('y', d => d.y0)\n      .attr('width', d => d.x1-d.x0)\n      .attr('height', d => d.y1-d.y0)\n      .style('fill', (d) => color(d.parent.data.name))\n      .style('stroke', '#cccccc')\n\n\n    g.append('text')\n      .attr('x', function (d) { return d.x0 })\n      .attr('y', function (d) { return d.y0 })\n      // .attr('dx', (d) => { return -d.data.name.length / 2 + 'em' })\n      // .attr('dy', (d) => { return '-0.5em' })\n      .attr('dx', function (d) { return (d.x1 - d.x0) / 2 }) // 文字水平居中\n      .attr('dy', function (d) { return (d.y1 - d.y0) / 2 - d.data.name.length / 2 * 12 }) // 文字垂直居中,有点瑕疵\n      .attr('font-size', function (d) { return 12 - d.depth + 'px' }) // 文字按深度缩小\n      // .attr('writing-mode', 'tb') // 文字从上往下书写\n      .text(function (d) { return d.data.name })\n      .attr('fill', '#f0f0f0')\n\n    g.append('text')\n      .attr('x', (d) => (d.x1 - d.x0) / 2 + d.x0)\n      .attr('y', (d) => (d.y1 - d.y0) / 2 + d.y0)\n      .attr('dx', (d) => { return -(d.value.toString().length + 2) / 4 + 'em' })\n      .attr('dy', (d) => { return '1em' })\n      .text((d) => { return '(' + d.value + ')' })\n      .attr('font-size', (d) => { return 14 - d.depth + 'px' })\n      .attr('fill', '#ffffff')\n\n\n  }\n\n  componentDidMount() {\n    this.drawTreeMap(this.data.treeMapData)\n  }\n\n  render() {\n    return <div></div>\n  }\n\n}\n\nexport default TreeMapChart"]},"metadata":{},"sourceType":"module"}