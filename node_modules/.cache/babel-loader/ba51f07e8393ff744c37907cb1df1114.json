{"ast":null,"code":"var _jsxFileName = \"/Volumes/Macintosh HD - \\u6570\\u636E/yu01/d3_ex/src/chart/stackChart/stackChart.jsx\";\nimport React, { Component } from \"react\";\nimport * as d3 from 'd3';\nimport { toJS } from \"mobx\";\n\nclass StackChart extends Component {\n  constructor(props) {\n    super(props);\n    this.data = props.chartState;\n  }\n\n  drawStack(data) {\n    const padding = this.data.padding;\n    const width = this.data.width;\n    const pieHeight = this.data.pieHeight;\n    const margin = 10;\n    const stack = d3.stack(); // .keys([\"apples\", \"bananas\", \"cherries\", \"dates\"])\n    // .order(d3.stackOrderNone)\n    // .offset(d3.stackOffsetNone);\n\n    const stackData = stack(data);\n    console.log(stackData);\n    const color = d3.scaleOrdinal(d3.schemeCategory10);\n    const svg = d3.select(\"body\").append(\"svg\").attr(\"width\", width).attr(\"height\", pieHeight).style('padding-left', padding.left).style('padding-top', padding.top); // x比例尺\n\n    let xScale = d3.scaleBand().range([0, width - padding.left - padding.right]); // x值域，其实就是月份\n\n    xScale.domain(data.map(d => d.month));\n    let yScale = d3.scaleLinear().range([pieHeight - padding.top - padding.bottom, 0]); // y值域，求的是转化后的数组的最后一个数组中的各个分数组中第二个元素的最大值，绕的我都有点晕，最大值怎么求可以自己写function\n\n    yScale.domain([0, d3.max(stackData[stackData.length - 1], item => item[1])]); // x轴和y轴\n\n    let xAxis = d3.axisBottom().scale(xScale);\n    let yAxis = d3.axisLeft(yScale); // 添加x轴\n\n    svg.append('g').attr('class', 'axis').attr('transform', 'translate(' + padding.left + ',' + (pieHeight - padding.bottom) + ')').call(xAxis); // 添加y轴\n\n    svg.append('g').attr('class', 'axis').attr('transform', 'translate(' + padding.left + ',' + padding.top + ')').call(yAxis); // 将二维数组的第一维剥离，打散成n列\n\n    let rectContainer = svg.selectAll('rectContainer').data(stackData).enter().append('g').attr('class', 'rectContainer').attr('fill', (d, i) => {\n      return color(i);\n    }); // 渲染每一列\n\n    rectContainer.selectAll('rect').data(d => d).enter().append('rect').attr('x', d => {\n      return xScale(d.data.month) + padding.left + margin / 2;\n    }).attr('y', d => {\n      return yScale(d[1]) + padding.top;\n    }).attr('width', d => {\n      return xScale.bandwidth() - margin;\n    }).attr('height', d => {\n      return pieHeight - padding.top - padding.bottom - yScale(d[1] - d[0]);\n    }).attr('stroke', '#ccc'); // 添加图例圆圈\n\n    svg.selectAll('circle').data(['apples', 'bananas', 'cherries', 'oranges']).enter().append('circle').attr('cx', d => {\n      return width - padding.right - 80;\n    }).attr('cy', (d, i) => {\n      return padding.top + 25 * i;\n    }).attr('r', '6').attr('fill', (d, i) => {\n      return color(i);\n    }); // 添加图例文字\n\n    let texts = svg.selectAll('textContainer').data(['apples', 'bananas', 'cherries', 'oranges']).enter().append('g').attr('class', 'textContainer');\n    texts.append('text').attr('x', d => {\n      return width - padding.right - 60;\n    }).attr('y', (d, i) => {\n      return padding.top + 25 * i;\n    }).attr('dy', '0.32em').text(d => d).attr('fill', (d, i) => color(i));\n  }\n\n  componentDidMount() {\n    this.drawStack(this.data.stackData);\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 12\n      }\n    });\n  }\n\n}\n\nexport default StackChart;","map":{"version":3,"sources":["/Volumes/Macintosh HD - 数据/yu01/d3_ex/src/chart/stackChart/stackChart.jsx"],"names":["React","Component","d3","toJS","StackChart","constructor","props","data","chartState","drawStack","padding","width","pieHeight","margin","stack","stackData","console","log","color","scaleOrdinal","schemeCategory10","svg","select","append","attr","style","left","top","xScale","scaleBand","range","right","domain","map","d","month","yScale","scaleLinear","bottom","max","length","item","xAxis","axisBottom","scale","yAxis","axisLeft","call","rectContainer","selectAll","enter","i","bandwidth","texts","text","componentDidMount","render"],"mappings":"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","sourcesContent":["import React,{Component} from \"react\";\nimport * as d3 from 'd3'\nimport {toJS} from \"mobx\";\n\nclass StackChart extends Component{\n  constructor(props) {\n    super(props);\n    this.data = props.chartState\n  }\n\n  drawStack (data) {\n    const padding = this.data.padding\n    const width = this.data.width\n    const pieHeight = this.data.pieHeight\n\n    const margin = 10\n\n    const stack = d3.stack()\n      // .keys([\"apples\", \"bananas\", \"cherries\", \"dates\"])\n      // .order(d3.stackOrderNone)\n      // .offset(d3.stackOffsetNone);\n\n    const stackData = stack(data)\n    console.log(stackData)\n\n    const color = d3.scaleOrdinal(d3.schemeCategory10)\n\n    const svg = d3.select(\"body\")\n      .append(\"svg\")\n      .attr(\"width\", width)\n      .attr(\"height\", pieHeight)\n      .style('padding-left', padding.left)\n      .style('padding-top', padding.top)\n\n    // x比例尺\n    let xScale = d3.scaleBand()\n      .range([0, width - padding.left - padding.right])\n\n    // x值域，其实就是月份\n    xScale.domain(data.map(d => d.month))\n\n    let yScale = d3.scaleLinear()\n      .range([pieHeight - padding.top - padding.bottom, 0])\n    // y值域，求的是转化后的数组的最后一个数组中的各个分数组中第二个元素的最大值，绕的我都有点晕，最大值怎么求可以自己写function\n    yScale.domain([0, d3.max(stackData[stackData.length - 1], (item) => item[1])])\n\n    // x轴和y轴\n    let xAxis = d3.axisBottom().scale(xScale)\n    let yAxis = d3.axisLeft(yScale)\n\n    // 添加x轴\n    svg.append('g')\n      .attr('class', 'axis')\n      .attr('transform', 'translate(' + padding.left + ',' + (pieHeight - padding.bottom) + ')')\n      .call(xAxis)\n\n    // 添加y轴\n    svg.append('g')\n      .attr('class', 'axis')\n      .attr('transform', 'translate(' + padding.left + ',' + padding.top + ')')\n      .call(yAxis)\n\n    // 将二维数组的第一维剥离，打散成n列\n    let rectContainer = svg.selectAll('rectContainer')\n      .data(stackData)\n      .enter()\n      .append('g')\n      .attr('class', 'rectContainer')\n      .attr('fill', (d, i) => { return color(i) })\n\n    // 渲染每一列\n    rectContainer.selectAll('rect')\n      .data((d) => d)\n      .enter()\n      .append('rect')\n      .attr('x', (d) => { return xScale(d.data.month) + padding.left + margin / 2 })\n      .attr('y', (d) => { return yScale(d[1]) + padding.top })\n      .attr('width', (d) => { return xScale.bandwidth() - margin })\n      .attr('height', (d) => { return pieHeight - padding.top - padding.bottom - yScale(d[1] - d[0]) })\n      .attr('stroke', '#ccc')\n\n    // 添加图例圆圈\n    svg.selectAll('circle')\n      .data(['apples', 'bananas', 'cherries', 'oranges'])\n      .enter()\n      .append('circle')\n      .attr('cx', (d) => { return width - padding.right - 80 })\n      .attr('cy', (d, i) => { return padding.top + 25 * i })\n      .attr('r', '6')\n      .attr('fill', (d, i) => { return color(i) })\n\n    // 添加图例文字\n    let texts = svg.selectAll('textContainer')\n      .data(['apples', 'bananas', 'cherries', 'oranges'])\n      .enter()\n      .append('g')\n      .attr('class', 'textContainer')\n    texts.append('text')\n      .attr('x', (d) => { return width - padding.right - 60 })\n      .attr('y', (d, i) => { return padding.top + 25 * i })\n      .attr('dy', '0.32em')\n      .text((d) => d)\n      .attr('fill', (d, i) => color(i))\n\n  }\n\n  componentDidMount() {\n    this.drawStack(this.data.stackData)\n  }\n\n  render() {\n    return <div></div>\n  }\n\n}\n\nexport default StackChart"]},"metadata":{},"sourceType":"module"}